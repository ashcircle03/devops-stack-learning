# ë¦¬ëˆ…ìŠ¤ë¡œ í•œ í•™ê¸° ì‚´ê¸°

í•œ í•™ê¸° ë™ì•ˆ ì§‘ì—ì„œ Ubuntuë¥¼ ì„¤ì¹˜í•˜ê³  DevOps ë„êµ¬ë“¤ì„ í•˜ë‚˜ì”© ìµí˜€ë‚˜ê°„ ê¸°ë¡ì…ë‹ˆë‹¤. 

ì „ì²´ ê³¼ì •ì€ ë¸”ë¡œê·¸ì— ì •ë¦¬í–ˆìŠµë‹ˆë‹¤: [velog.io/@ashcircle03/series/ë¦¬ëˆ…ìŠ¤](https://velog.io/@ashcircle03/series/%EB%A6%AC%EB%88%85%EC%8A%A4)

## ë­˜ ë°°ì› ë‚˜?

- Ubuntu ì„¤ì¹˜í•˜ê³  ê¸°ë³¸ ëª…ë ¹ì–´ë“¤ ìµíˆê¸°
- í„°ë¯¸ë„ì„ ì˜ˆì˜ê²Œ ê¾¸ë¯¸ê¸° (Warp, Zsh)
- Dockerë¡œ ì»¨í…Œì´ë„ˆ ë‹¤ë£¨ê¸°
- Kubernetes í´ëŸ¬ìŠ¤í„° ë§Œë“¤ì–´ë³´ê¸°
- Jenkinsë¡œ ìë™ ë°°í¬ êµ¬ì¶•í•˜ê¸°
- Prometheus, Grafanaë¡œ ëª¨ë‹ˆí„°ë§í•˜ê¸°
- ì‹¤ì œë¡œ ëŒì•„ê°€ëŠ” Discord ë´‡ ë§Œë“¤ê¸°

## ì„¤ì¹˜í•œ í”„ë¡œê·¸ë¨ë“¤

ê²°êµ­ 12ê°œë‚˜ ì„¤ì¹˜í–ˆë„¤ìš”. ì´ë ‡ê²Œ ë†“ê³  ë³´ë‹ˆê¹Œ ì¢€ ë§ê¸´ í•˜ë„¤...

| ìˆœì„œ | í”„ë¡œê·¸ë¨ | ìš©ë„ |
|------|----------|------|
| 1 | Ubuntu | ìš´ì˜ì²´ì œ |
| 2 | Warp | í„°ë¯¸ë„ |
| 3 | Zsh | ì‰˜ |
| 4 | VS Code | ì—ë””í„° |
| 5 | Docker | ì»¨í…Œì´ë„ˆ |
| 6 | Minikube | Kubernetes |
| 7 | Miniconda | Python í™˜ê²½ |
| 8 | Jenkins | CI/CD |
| 9 | Discord.py | ë´‡ ê°œë°œ |
| 10 | Prometheus | ëª¨ë‹ˆí„°ë§ |
| 11 | Grafana | ëŒ€ì‹œë³´ë“œ | 
| 12 | Alertmanager | ì•Œë¦¼ | 


## ì§€ê¸ˆ ë­ê°€ ëŒê³  ìˆë‚˜

ë‹¤ ë§Œë“¤ì–´ë†“ê³  ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ì˜ ëŒì•„ê°€ê³  ìˆìŠµë‹ˆë‹¤.

- Discord ë´‡ì´ ì•ˆ ì£½ê³  ëŒì•„ê°
- Prometheusê°€ 30ì´ˆë§ˆë‹¤ 44ê°œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì¤‘
- Grafana ëŒ€ì‹œë³´ë“œë„ í•œê¸€ë¡œ ì˜ ë‚˜ì˜´
- Slack ì•Œë¦¼ë„ ì œëŒ€ë¡œ ì˜´
- ì§€ê¸ˆê¹Œì§€ 45ê°œ ë©”ì‹œì§€ ì²˜ë¦¬í•¨


Discord ë´‡ì€ ê·¸ëƒ¥ ì´ìƒí•œ ê¸°ëŠ¥ë§Œ ë„£ì–´ë’€ì–´ìš”. :

- `?ping` - ì‘ë‹µ ì†ë„ ì¬ê¸°
- `?add 1 2` - ë§ì…ˆ (ê³„ì‚°ê¸° ì“°ëŠ”ê²Œ ë‚˜ìŒ)
- `?roll 2d6` - ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°
- `?time` - ì‹œê°„ í™•ì¸
- `?choose ì‚¬ê³¼ ë°”ë‚˜ë‚˜` - ëœë¤ ì„ íƒ
- `?info` - ë´‡ ì •ë³´

ê·¸ë˜ë„ ëª¨ë‹ˆí„°ë§ì€ ì œëŒ€ë¡œ ë˜ë„¤ìš”.

## í´ë” êµ¬ì¡°

```
project1/
â”œâ”€â”€ src/                    # Python ì½”ë“œë“¤
â”‚   â”œâ”€â”€ discord_bot.py      # ë©”ì¸ ë´‡ ì½”ë“œ
â”‚   â”œâ”€â”€ slack_bot.py        # Slack ë´‡ ì½”ë“œ
â”‚   â”œâ”€â”€ requirements.txt    # í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤
â”‚   â””â”€â”€ test_discord_bot.py # í…ŒìŠ¤íŠ¸ (ì˜ ì•ˆ ì”€)
â”‚
â”œâ”€â”€ docker/                 # Docker ì„¤ì •
â”‚   â”œâ”€â”€ Dockerfile          # Discord ë´‡ìš© ì´ë¯¸ì§€
â”‚   â”œâ”€â”€ Dockerfile.slack    # Slack ë´‡ìš© ì´ë¯¸ì§€
â”‚   â””â”€â”€ docker-compose.yml  # ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©
â”‚
â”œâ”€â”€ k8s/                    # Kubernetes ì„¤ì • íŒŒì¼ë“¤
â”‚   â”œâ”€â”€ app/                # Discord ë´‡ ë°°í¬ ì„¤ì •
â”‚   â””â”€â”€ monitoring/         # ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ
â”‚       â”œâ”€â”€ prometheus/     # ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì„¤ì •
â”‚       â”œâ”€â”€ grafana/        # ëŒ€ì‹œë³´ë“œ ì„¤ì •
â”‚       â”œâ”€â”€ alertmanager/   # ì•Œë¦¼ ì„¤ì •
â”‚       â”œâ”€â”€ slack-bot/      # Slack ë´‡ ì„¤ì •
â”‚       â”œâ”€â”€ dashboards/     # Grafana ëŒ€ì‹œë³´ë“œ JSON
â”‚       â””â”€â”€ rbac/           # ê¶Œí•œ ì„¤ì •
â”‚
â”œâ”€â”€ ci/                     # Jenkins CI/CD ì„¤ì •
â”œâ”€â”€ images/                 # ìŠ¤í¬ë¦°ìƒ· ë° ì´ë¯¸ì§€ë“¤
â”œâ”€â”€ requirements.txt        # í”„ë¡œì íŠ¸ ì˜ì¡´ì„±
â”œâ”€â”€ Jenkinsfile             # Jenkins íŒŒì´í”„ë¼ì¸
â””â”€â”€ ëŠë‚€ì .md               # í”„ë¡œì íŠ¸ íšŒê³ 
```

## ì–´ë–»ê²Œ ëŒë ¤ë³´ë‚˜

```bash
# ë´‡ ìƒíƒœ í™•ì¸
kubectl get pods -l app=discord-bot

# Grafana ë³´ê¸° (ì´ë¯¸ í¬íŠ¸í¬ì›Œë”© ë˜ì–´ìˆìŒ)
# http://localhost:3000 ì ‘ì†
# admin/adminìœ¼ë¡œ ë¡œê·¸ì¸

# ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸
./test-monitoring.sh
```

## ì£¼ìš” ë©”íŠ¸ë¦­

Discord ë´‡ì—ì„œ ìˆ˜ì§‘í•˜ëŠ” í•µì‹¬ ì§€í‘œë“¤:
- `discord_bot_commands_total` - ëª…ë ¹ì–´ ì‹¤í–‰ í†µê³„
- `discord_bot_messages_sent_total` - ë©”ì‹œì§€ ì „ì†¡ ìˆ˜
- `discord_bot_errors_total` - ì—ëŸ¬ ë°œìƒ íšŸìˆ˜
- `discord_bot_heartbeat_timestamp` - ë´‡ ìƒíƒœ í™•ì¸
- `discord_bot_message_latency_seconds` - ì‘ë‹µ ì‹œê°„

## Discord ë´‡ ëª…ë ¹ì–´

í˜„ì¬ ì§€ì›í•˜ëŠ” ëª…ë ¹ì–´ë“¤:
- `?ping` - ë´‡ ì‘ë‹µ ì‹œê°„ ë° ìƒíƒœ í™•ì¸
- `?info` - ë´‡ ì •ë³´ ë° ì„œë²„ í†µê³„ í‘œì‹œ  
- `?add <ìˆ«ì1> <ìˆ«ì2>` - ë‘ ìˆ«ì ë§ì…ˆ ê³„ì‚°
- `?roll <NdN>` - ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (ì˜ˆ: 2d6, 1d20)
- `?time` - í˜„ì¬ í•œêµ­ ì‹œê°„ í‘œì‹œ
- `?choose <ì„ íƒì§€ë“¤>` - ì—¬ëŸ¬ ì„ íƒì§€ ì¤‘ ë¬´ì‘ìœ„ ì„ íƒ

## CI/CD íŒŒì´í”„ë¼ì¸

```mermaid
graph TD
    A[ê°œë°œì] -->|Push Code| B[GitHub]
    B -->|Webhook| C[Jenkins Pipeline]
    
    C --> D[Checkout ì†ŒìŠ¤ ì½”ë“œ]
    D --> E[Setup Environment]
    E --> F[Python í…ŒìŠ¤íŠ¸ ì‹¤í–‰]
    F --> G[Docker ì´ë¯¸ì§€ ë¹Œë“œ]
    G --> H[Docker Hubì— í‘¸ì‹œ]
    H --> I[Kubernetes ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸]
    I --> J[Kubernetes ë°°í¬]
    J --> K[ë°°í¬ ìƒíƒœ í™•ì¸]
    
    subgraph "Jenkins Stages"
        D
        E
        F
        G
        H
        I
        J
        K
    end
    
    subgraph "External Services"
        L[Docker Hub Registry]
        M[Kubernetes Cluster]
        N[Discord Bot Running]
    end
    
    G -->|Push Image| L
    J -->|Deploy to| M
    M -->|Run Pod| N
    
    subgraph "Docker Agents"
        O[python:3.9]
        P[docker:20.10]
    end
    
    F -.->|Uses| O
    G -.->|Uses| P
```

## ë­˜ ë°°ìš´ ê±´ê°€

### ê¸°ìˆ ì ì¸ ê²ƒë“¤
- Ubuntu ëª…ë ¹ì–´ë“¤ (ls, cd, grep, ë“±ë“±)
- Dockerë¡œ ì´ë¯¸ì§€ ë§Œë“¤ê³  ì»¨í…Œì´ë„ˆ ëŒë¦¬ê¸°
- Kubernetes Pod, Service, Deployment ê°œë…
- Jenkins íŒŒì´í”„ë¼ì¸ ì§œê¸° (YAML ì§€ì˜¥)
- Prometheus ì¿¼ë¦¬ ë¬¸ë²• (PromQL)
- Grafana ëŒ€ì‹œë³´ë“œ ë§Œë“¤ê¸°

### ì‹¤ì œë¡œ ìœ ìš©í–ˆë˜ ê²ƒë“¤
- ë¦¬ëˆ…ìŠ¤ í™˜ê²½ì— ìµìˆ™í•´ì§
- ì»¨í…Œì´ë„ˆ ê¸°ë°˜ìœ¼ë¡œ ìƒê°í•˜ê²Œ ë¨
- ëª¨ë‹ˆí„°ë§ì˜ ì¤‘ìš”ì„± ê¹¨ë‹¬ìŒ
- ìë™í™”ê°€ ì–¼ë§ˆë‚˜ í¸í•œì§€ ì•Œê²Œ ë¨
- ë¬¸ì œ ìƒê²¼ì„ ë•Œ ë¡œê·¸ ë³´ëŠ” ìŠµê´€ ìƒê¹€

ì†”ì§íˆ ì²˜ìŒì—” ê·¸ëƒ¥ "ë¦¬ëˆ…ìŠ¤ ì¨ë³´ì" ì˜€ëŠ”ë° ì–´ì©Œë‹¤ ë³´ë‹ˆ DevOps ìŠ¤íƒì„ ê±°ì˜ ë‹¤ ë§Œì ¸ë³¸ ì…ˆì´ë„¤ìš”.

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

ì „ì²´ ì—°ê²° êµ¬ì¡°ë¥¼ í•œëˆˆì— ë³´ë ¤ë©´ â†’ [ğŸ“Š ìƒì„¸ ì‹œìŠ¤í…œ ë‹¤ì´ì–´ê·¸ë¨](./system-architecture-diagram.md)

```mermaid
graph TB
    subgraph "CI/CD"
        GITHUB[GitHub ğŸ“] --> JENKINS[Jenkins ğŸ”§]
        JENKINS --> DOCKERHUB[Docker Hub ğŸ“¦]
    end
    
    subgraph "Kubernetes Cluster"
        DOCKERHUB --> DISCORDBOT[Discord Bot ğŸ¤–]
        DOCKERHUB --> SLACKBOT[Slack Bot ğŸ’¬]
        
        DISCORDBOT -->|ë©”íŠ¸ë¦­| PROMETHEUS[Prometheus ğŸ“Š]
        SLACKBOT -->|ë©”íŠ¸ë¦­| PROMETHEUS
        PROMETHEUS --> GRAFANA[Grafana ğŸ“ˆ]
        PROMETHEUS -->|ì•ŒëŒ| ALERTMANAGER[AlertManager ğŸš¨]
    end
    
    subgraph "External APIs"
        DISCORDBOT --> DISCORD[Discord API ğŸ’¬]
        ALERTMANAGER --> SLACK[Slack API ğŸ“¢]
    end
    
    classDef cicd fill:#f3e5f5
    classDef k8s fill:#e8f5e8
    classDef external fill:#fff3e0
    
    class GITHUB,JENKINS,DOCKERHUB cicd
    class DISCORDBOT,SLACKBOT,PROMETHEUS,GRAFANA,ALERTMANAGER k8s
    class DISCORD,SLACK external
```

### ğŸ”— ì£¼ìš” ì—°ê²°ì 
- **Jenkins** â†’ Docker Hub â†’ Kubernetes (ìë™ ë°°í¬)
- **Discord/Slack Bot** â†’ Prometheus (ë©”íŠ¸ë¦­ ìˆ˜ì§‘)
- **Prometheus** â†’ Grafana (ì‹œê°í™”) + AlertManager (ì•Œë¦¼)
- **AlertManager** â†’ Slack (ì—ëŸ¬ ì•Œë¦¼)

### ğŸŒ ì ‘ì† ì£¼ì†Œ
- **Prometheus**: http://localhost:30090
- **Grafana**: http://localhost:30300 (admin/admin)
- **Slack Bot Test**: http://localhost:30500
- **AlertManager**: `kubectl port-forward` í›„ http://localhost:9093

## í˜„ì¬ ìƒí™©
[jenkins](/images/jenkins.png)
Jenkins Build #117ê¹Œì§€ ì„±ê³µí–ˆê¸´ í•œë°, ì‚¬ì‹¤ ì  í‚¨ìŠ¤ë¥¼ ì¬ì„¤ì¹˜ í•œê±°ë¼ ì´ì „ì— +50ë²ˆ ì‹œë„ ë”í•´ì•¼ë˜ìš”.

[discord](/images/discordbot.png)
ìŠ¤ìŠ¤ë¡œ add ëª…ë ¹ì–´ 31ë²ˆ, roll ëª…ë ¹ì–´ 3ë²ˆ ì¨ë³´ë©´ì„œ ê¸°ëŠ¥ í™•ì¸í–ˆë„¤ìš”. 

[prometheus](/images/prometheus.png)
Prometheus ì¿¼ë¦¬ë¬¸ì„ í†µí•´ ëª¨ë‹ˆí„°ë§ë„ í•´ë³´ê³ 

[grafana](/images/grafana.png)
Grafanaë¡œ ì˜ˆìœ ëŒ€ì‹œë³´ë“œë„ ë´¤ë‹µë‹ˆë‹¤.
ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”íŠ¸ë¦­ì´ ë³€í•˜ëŠ” ê±¸ ë³´ë‹ˆê¹Œ ë­”ê°€ ì „ë¬¸ê°€ê°€ ëœ ê¸°ë¶„ì…ë‹ˆë‹¤.

[alertmanager](/images/slackbot.png)
ìŠ¬ë™ ë´‡ì„ ë§Œë“¤ê³  Alertmanagerë¥¼ ì´ìš©í•´ì„œ ë””ì½”ë´‡ ì—ëŸ¬ë„ 30ë¶„ ë§ˆë‹¤ ì˜¬ ìˆ˜ ìˆê²Œ í–ˆìŠµë‹ˆë‹¤.

